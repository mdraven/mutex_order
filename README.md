Чтобы не было deadlock'ов мьютексы нужно всегда захватывать в нужном порядке. Чтобы этот порядок был
контролируем введём 2 сущности.
1. уникальный тип для мьютекса, чтобы отличать один от другого:
  using MapMutex = named_mutex<struct map_mutex>;
  using MapElemMutex = named_mutex<struct map_elem_mutex>;
2. тип который определяет в каком порядке можно захватывать мьютексы:
  using MutexOrder = mutex_order<MapMutex, MapElemMutex>;
Для 2 не обязательно чтобы захватывались все мьютексы из списка. И не обязательно чтобы не было дыр при захвате.
Главное, чтобы они захватывались в приведённом порядке.
Таким образом MutexOrder может быть один на всю программу и содержать все named_mutex.



TODO: написать про случай с элементами из map в которых есть мьютекс. И о том, что данная штука для этого не применима
      и надо делать по старинке через mutex.lock().
